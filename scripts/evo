#!/bin/bash
# evo - è¿›åŒ–ç³»ç»Ÿç»Ÿä¸€å…¥å£ v4
# ç”¨æ³•: evo <command> [args...]

WORKSPACE="/home/jinyang/.openclaw/workspace"
SCRIPTS="$WORKSPACE/scripts"

# é¢œè‰²
CYAN='\033[0;36m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

show_help() {
    echo -e "${CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${CYAN}â•‘              ğŸ§¬ Multi-Agent è¿›åŒ–ç³»ç»Ÿ v4                          â•‘${NC}"
    echo -e "${CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo -e "${GREEN}ç›‘æ§å‘½ä»¤:${NC}"
    echo "  evo status          - æŸ¥çœ‹ agent çŠ¶æ€"
    echo "  evo dashboard       - å®æ—¶ç›‘æ§ä»ªè¡¨ç›˜"
    echo "  evo check           - æ£€æŸ¥å¹¶è‡ªåŠ¨ä¿®å¤é—®é¢˜"
    echo "  evo logs [hours]    - æŸ¥çœ‹æ—¥å¿—åˆ†æ"
    echo "  evo health          - ç³»ç»Ÿå¥åº·æŠ¥å‘Š"
    echo ""
    echo -e "${GREEN}ä»»åŠ¡ç®¡ç†:${NC}"
    echo "  evo add <task> [type] [agent]  - æ·»åŠ ä»»åŠ¡"
    echo "  evo list [filter]              - åˆ—å‡ºä»»åŠ¡"
    echo "  evo decompose <task>           - æ™ºèƒ½åˆ†è§£ä»»åŠ¡"
    echo "  evo dispatch <agent>           - æ‰‹åŠ¨æ´¾æ´»"
    echo ""
    echo -e "${GREEN}ä¼˜åŒ–ç³»ç»Ÿ:${NC}"
    echo "  evo optimize        - è¿è¡Œè‡ªåŠ¨ä¼˜åŒ–"
    echo "  evo optimize report - æŸ¥çœ‹ä¼˜åŒ–æŠ¥å‘Š"
    echo "  evo learn           - ä»å½“å‰è¾“å‡ºå­¦ä¹ "
    echo "  evo report          - ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š"
    echo ""
    echo -e "${GREEN}ç»´æŠ¤å‘½ä»¤:${NC}"
    echo "  evo repair <agent>  - ä¿®å¤æŒ‡å®š agent"
    echo "  evo restart <agent> - é‡å¯æŒ‡å®š agent"
    echo "  evo cleanup         - æ¸…ç†å·²å®Œæˆä»»åŠ¡"
    echo ""
    echo -e "${YELLOW}ç¤ºä¾‹:${NC}"
    echo "  evo add 'ä¿®å¤ç¼–è¯‘é”™è¯¯' compile codex-agent"
    echo "  evo decompose 'å›½é™…åŒ– crates/terminal æ¨¡å—'"
    echo "  evo repair gemini-agent"
    echo "  evo logs 6"
}

case "${1:-help}" in
    # ç›‘æ§
    status)
        "$SCRIPTS/evolution-v4.sh" status
        ;;
    dashboard|dash)
        "$SCRIPTS/dashboard.sh" "${2:-once}"
        ;;
    check)
        "$SCRIPTS/evolution-v4.sh" check
        ;;
    logs)
        "$SCRIPTS/log-analyzer.sh" full "${2:-6}"
        ;;
    health)
        "$SCRIPTS/log-analyzer.sh" health
        ;;
    
    # ä»»åŠ¡ç®¡ç†
    add)
        "$SCRIPTS/priority-queue.sh" add "$2" "$3" "$4"
        ;;
    list)
        "$SCRIPTS/priority-queue.sh" list "$2"
        ;;
    stats)
        "$SCRIPTS/priority-queue.sh" stats
        ;;
    decompose)
        "$SCRIPTS/task-decomposer.sh" smart "$2"
        ;;
    dispatch)
        if [[ -n "$2" ]]; then
            source "$SCRIPTS/evolution-v4.sh"
            dispatch_task "$2"
        else
            echo "ç”¨æ³•: evo dispatch <agent>"
        fi
        ;;
    
    # ä¼˜åŒ–
    optimize)
        if [[ "$2" == "report" ]]; then
            "$SCRIPTS/auto-optimize.sh" report
        else
            "$SCRIPTS/auto-optimize.sh" run
        fi
        ;;
    learn)
        "$SCRIPTS/auto-learn.sh" auto 2>/dev/null || echo "auto-learn.sh ä¸å­˜åœ¨"
        ;;
    report)
        "$SCRIPTS/auto-learn.sh" report 2>/dev/null || "$SCRIPTS/log-analyzer.sh" full
        ;;
    
    # ç»´æŠ¤
    repair)
        "$SCRIPTS/evolution-v4.sh" repair "$2"
        ;;
    restart)
        if [[ -n "$2" ]]; then
            source "$SCRIPTS/evolution-v4.sh"
            restart_agent "$2"
            echo "âœ… å·²é‡å¯ $2"
        else
            echo "ç”¨æ³•: evo restart <agent>"
        fi
        ;;
    cleanup)
        "$SCRIPTS/priority-queue.sh" cleanup 2>/dev/null
        "$SCRIPTS/auto-optimize.sh" cleanup
        ;;
    
    # å¸®åŠ©
    help|--help|-h|*)
        show_help
        ;;
esac
