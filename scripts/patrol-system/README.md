# ğŸ›¡ï¸ Patrol System - åˆ†å±‚å·¡æ£€æ¶æ„

## è®¾è®¡ç›®æ ‡
- **æ°¸ä¸åœæœº**: å³ä½¿ LLM API rate limitï¼Œå·¡æ£€ä¹Ÿèƒ½ç»§ç»­
- **åˆ†å±‚é™çº§**: å¤æ‚å†³ç­–é™çº§åˆ°ç®€å•è§„åˆ™
- **è‡ªåŠ¨æ¢å¤**: æ£€æµ‹é—®é¢˜å¹¶è‡ªåŠ¨ä¿®å¤

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 0: çŠ¶æ€é‡‡é›† (æ¯åˆ†é’Ÿ)                                      â”‚
â”‚     patrol-collector.sh â†’ Redis                                 â”‚
â”‚     çº¯ bashï¼Œä¸ä¾èµ–ä»»ä½• API                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 1: è‡ªåŠ¨ä¿®å¤ (æ¯åˆ†é’Ÿ)                                      â”‚
â”‚     patrol-fixer.sh                                             â”‚
â”‚     è§„åˆ™å¼•æ“ï¼Œè‡ªåŠ¨å¤„ç†å¸¸è§é—®é¢˜                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 2: æ™ºèƒ½å†³ç­– (æ¯ 5 åˆ†é’Ÿ)                                   â”‚
â”‚     patrol-brain.sh                                             â”‚
â”‚     ä»»åŠ¡åˆ†é…ã€ä¼šè¯ç®¡ç†ã€å¤æ‚å†³ç­–                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 3: é€šçŸ¥ (äº‹ä»¶é©±åŠ¨)                                        â”‚
â”‚     patrol-notify.sh                                            â”‚
â”‚     é‡è¦äº‹ä»¶é€šçŸ¥ä¸»ä¼šè¯                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Redis Key è®¾è®¡

```
patrol:agent:<name>:state      # å½“å‰çŠ¶æ€
patrol:agent:<name>:context    # context ä½¿ç”¨ç‡
patrol:agent:<name>:task       # å½“å‰ä»»åŠ¡
patrol:agent:<name>:idle_since # ç©ºé—²å¼€å§‹æ—¶é—´
patrol:queue:tasks             # å¾…åˆ†é…ä»»åŠ¡é˜Ÿåˆ—
patrol:queue:problems          # å¾…å¤„ç†é—®é¢˜é˜Ÿåˆ—
patrol:stats:fixes             # ä¿®å¤ç»Ÿè®¡
patrol:stats:dispatches        # æ´¾å‘ç»Ÿè®¡
patrol:notify:pending          # å¾…é€šçŸ¥æ¶ˆæ¯
```

## ä½¿ç”¨æ–¹æ³•

```bash
# å®‰è£…åˆ°ç³»ç»Ÿ crontab
./install.sh

# æ‰‹åŠ¨è¿è¡Œ
./patrol-collector.sh   # é‡‡é›†çŠ¶æ€
./patrol-fixer.sh       # è‡ªåŠ¨ä¿®å¤
./patrol-brain.sh       # æ™ºèƒ½å†³ç­–
./patrol-notify.sh      # å‘é€é€šçŸ¥

# æŸ¥çœ‹çŠ¶æ€
./patrol-status.sh
```
