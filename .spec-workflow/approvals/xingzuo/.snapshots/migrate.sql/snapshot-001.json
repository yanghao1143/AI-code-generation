{
  "id": "snapshot_1759290528652_07z8wmhpl",
  "approvalId": "approval_1759290528640_sbloya1nb",
  "approvalTitle": "执行 CHANGE 通道 DDL（测试环境）",
  "version": 1,
  "timestamp": "2025-10-01T03:48:48.652Z",
  "trigger": "initial",
  "status": "pending",
  "content": "CREATE TABLE IF NOT EXISTS `anchor` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `name` VARCHAR(255) NOT NULL,\n  `level` VARCHAR(255) NOT NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE IF NOT EXISTS `fan` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `name` VARCHAR(255) NOT NULL,\n  `gender` VARCHAR(255) NULL,\n  `birthday` VARCHAR(255) NULL,\n  `zodiac` VARCHAR(255) NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE IF NOT EXISTS `tag` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `name` VARCHAR(255) NOT NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE IF NOT EXISTS `conversation` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `anchor_id` BIGINT NOT NULL,\n  `fan_id` BIGINT NOT NULL,\n  `content` TEXT NOT NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE IF NOT EXISTS `fortune_service` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `code` VARCHAR(255) NOT NULL,\n  `name` VARCHAR(255) NOT NULL,\n  `input_schema` TEXT NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE IF NOT EXISTS `fortune_record` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `fan_id` BIGINT NOT NULL,\n  `service_id` BIGINT NOT NULL,\n  `result` TEXT NOT NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE IF NOT EXISTS `topic` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `name` VARCHAR(255) NOT NULL,\n  `popularity` INT NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE IF NOT EXISTS `script` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `title` VARCHAR(255) NOT NULL,\n  `content` TEXT NOT NULL,\n  `topic_id` BIGINT NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE IF NOT EXISTS `workflow` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `name` VARCHAR(255) NOT NULL,\n  `definition` TEXT NOT NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nALTER TABLE `conversation` ADD CONSTRAINT `fk_conversation_anchor_id` FOREIGN KEY (`anchor_id`) REFERENCES `anchor`(`id`) ON DELETE CASCADE ON UPDATE CASCADE;\nALTER TABLE `conversation` ADD CONSTRAINT `fk_conversation_fan_id` FOREIGN KEY (`fan_id`) REFERENCES `fan`(`id`) ON DELETE CASCADE ON UPDATE CASCADE;\nALTER TABLE `fortune_record` ADD CONSTRAINT `fk_fortune_record_fan_id` FOREIGN KEY (`fan_id`) REFERENCES `fan`(`id`) ON DELETE CASCADE ON UPDATE CASCADE;\nALTER TABLE `fortune_record` ADD CONSTRAINT `fk_fortune_record_service_id` FOREIGN KEY (`service_id`) REFERENCES `fortune_service`(`id`) ON DELETE CASCADE ON UPDATE CASCADE;\nALTER TABLE `script` ADD CONSTRAINT `fk_script_topic_id` FOREIGN KEY (`topic_id`) REFERENCES `topic`(`id`) ON DELETE CASCADE ON UPDATE CASCADE;\n\nCREATE TABLE IF NOT EXISTS `fan_tags` (\n  `fan_id` BIGINT NOT NULL,\n  `tag_id` BIGINT NOT NULL,\n  PRIMARY KEY (`fan_id`, `tag_id`),\n  CONSTRAINT `fk_fan_tags_fan` FOREIGN KEY (`fan_id`) REFERENCES `fan`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,\n  CONSTRAINT `fk_fan_tags_tag` FOREIGN KEY (`tag_id`) REFERENCES `tag`(`id`) ON DELETE CASCADE ON UPDATE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;",
  "fileStats": {
    "size": 3284,
    "lines": 81,
    "lastModified": "2025-10-01T03:20:07.326Z"
  },
  "comments": []
}