{
  "id": "snapshot_1759338551505_126dlpjaf",
  "approvalId": "approval_1759338551497_h3gbmc53f",
  "approvalTitle": "Approval: Run db-runner CHANGE for ai-codegen (sqlHash=3b8969c9f54628d339adc8b1f6d2b033aedb78a720be7c30c7020cae43b5a942)",
  "version": 1,
  "timestamp": "2025-10-01T17:09:11.505Z",
  "trigger": "initial",
  "status": "pending",
  "content": "CREATE TABLE IF NOT EXISTS `anchor` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `name` VARCHAR(255) NOT NULL,\n  `level` VARCHAR(255) NOT NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE IF NOT EXISTS `fan` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `name` VARCHAR(255) NOT NULL,\n  `gender` VARCHAR(255) NULL,\n  `birthday` VARCHAR(255) NULL,\n  `zodiac` VARCHAR(255) NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE IF NOT EXISTS `tag` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `name` VARCHAR(255) NOT NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- 业务主题（topic）：用于对话归类\nCREATE TABLE IF NOT EXISTS `topic` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `title` VARCHAR(255) NOT NULL,\n  `name` VARCHAR(255) NOT NULL,\n  `popularity` INT NOT NULL DEFAULT 0,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- 脚本（script）：用于自动化或占卜脚本内容\nCREATE TABLE IF NOT EXISTS `script` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `name` VARCHAR(255) NOT NULL,\n  `title` VARCHAR(255) NOT NULL,\n  `topic_id` BIGINT NULL,\n  `content` TEXT NULL,\n  `created_at` DATETIME NOT NULL,\n  CONSTRAINT `fk_script_topic` FOREIGN KEY (`topic_id`) REFERENCES `topic`(`id`) ON DELETE SET NULL ON UPDATE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- 工作流（workflow）：用于脚本编排与版本化\nCREATE TABLE IF NOT EXISTS `workflow` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `name` VARCHAR(255) NOT NULL,\n  `version` VARCHAR(64) NOT NULL,\n  `definition` TEXT NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- 占卜服务（fortune_service）：服务目录\nCREATE TABLE IF NOT EXISTS `fortune_service` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `name` VARCHAR(255) NOT NULL,\n  `code` VARCHAR(255) NOT NULL,\n  `input_schema` TEXT NULL,\n  `created_at` DATETIME NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nCREATE UNIQUE INDEX IF NOT EXISTS `uk_fortune_service_code` ON `fortune_service`(`code`);\n\n-- 占卜记录（fortune_record）：粉丝在某服务下的测算结果\nCREATE TABLE IF NOT EXISTS `fortune_record` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `fan_id` BIGINT NOT NULL,\n  `service_id` BIGINT NOT NULL,\n  `result` TEXT NULL,\n  `created_at` DATETIME NOT NULL,\n  CONSTRAINT `fk_fortune_record_fan` FOREIGN KEY (`fan_id`) REFERENCES `fan`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,\n  CONSTRAINT `fk_fortune_record_service` FOREIGN KEY (`service_id`) REFERENCES `fortune_service`(`id`) ON DELETE CASCADE ON UPDATE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- 会话（conversation）：粉丝与主题的对话记录入口\nCREATE TABLE IF NOT EXISTS `conversation` (\n  `id` BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `fan_id` BIGINT NOT NULL,\n  `topic_id` BIGINT NULL,\n  `anchor_id` BIGINT NOT NULL,\n  `content` TEXT NULL,\n  `created_at` DATETIME NOT NULL,\n  CONSTRAINT `fk_conversation_fan` FOREIGN KEY (`fan_id`) REFERENCES `fan`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,\n  CONSTRAINT `fk_conversation_topic` FOREIGN KEY (`topic_id`) REFERENCES `topic`(`id`) ON DELETE SET NULL ON UPDATE CASCADE,\n  CONSTRAINT `fk_conversation_anchor` FOREIGN KEY (`anchor_id`) REFERENCES `anchor`(`id`) ON DELETE CASCADE ON UPDATE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\nCREATE TABLE IF NOT EXISTS `fan_tags` (\n  `fan_id` BIGINT NOT NULL,\n  `tag_id` BIGINT NOT NULL,\n  PRIMARY KEY (`fan_id`, `tag_id`),\n  CONSTRAINT `fk_fan_tags_fan` FOREIGN KEY (`fan_id`) REFERENCES `fan`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,\n  CONSTRAINT `fk_fan_tags_tag` FOREIGN KEY (`tag_id`) REFERENCES `tag`(`id`) ON DELETE CASCADE ON UPDATE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;",
  "fileStats": {
    "size": 3828,
    "lines": 93,
    "lastModified": "2025-10-01T17:08:03.312Z"
  },
  "comments": []
}